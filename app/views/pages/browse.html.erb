<script>
$(document).ready(function () {
  var $browse_list = $("#browse-list");
  var genre_id = { 28: "Action", 12: "Adventure", 16: "Animation", 35: "Comedy", 
  99: "Documentary", 18: "Drama", 10751: "Family", 14: "Fantasy", 36: "History", 
  27: "Horror", 10402: "Music", 9648: "Mystery", 10479: "Romance", 
  878: "Science Fiction", 10770: "TV Movie", 53: "Thriller", 10752: "War", 37: "Western" }
  
  browseMovies();

  function browseMovies() {
    $.ajax({
      type: "GET",
      url: "https://api.themoviedb.org/3/movie/popular?api_key=4aa07b165bfe3ed8596da63f31c9a2bc&language=en-US&page=1",
      dataType: "json",
      success: function (result) {
        for (i = 0; i < result["results"].length; i++) {
          var image = "https://image.tmdb.org/t/p/w500/" + result["results"][i]["poster_path"];
          var genre = genre_id[result["results"][i]["genre_ids"][0]];
          var movie_title = result["results"][i]["title"]; 
          var movie_id = result["results"][i]["id"];
          var movie_release = result["results"][i]["release_date"];
          
          $browse_list.append("<tr>" 
          + "<td><img src=\"" + image + "\" width=\"250\"" + "\" /></td>" 
          + "<td><strong>" + movie_title + "</strong><br /><a href='/movies/" + movie_id + "'>View/ Review</a></td>"
          + "<td><p>" + genre + "</p></td>"
          + "<td><p>" + movie_release + "</p></td>"
          + "</tr>"
          );
        }
      $(".movie-table").tablesorter(); 
      },
      error: function (xhr, status, error) {
        $browse_list.html("Result: " + status + " " + error + " " + xhr.status + " " + xhr.statusText)
      }
    });
  }
});

</script>


<div class="browse-page">

  <div class="browse-listing-index">
    <h2 class="heading">The Most Popular Movies</h2>
    <table class="movie-table tablesorter">
      <thead>
        <tr>
          <th class="{sorter: false}"></th>
          <th>Title<img src="/assets/bg.gif"/></th>
          <th>Genre<img src="/assets/bg.gif"/></th>
          <th>Release Date<img src="/assets/bg.gif"/></th>
        </tr>
      </thead>
      <tbody id="browse-list">
      </tbody>
    </table>
  </div>
  
  <div class="browse-reviews">
    <h2 class="heading">Recent Reviews</h2>
    <table>
    <% @reviews.take(5).each do |review| %>

      <div class="single-review">
        <span class="rating"><a href="/movies/<%= review.movie.id %>"><%= review.movie.title %></a><br />
        <%= review.rating %>/10</span><br/>
        <span class="author">Author: <%= review.user_email %></span><br/>
        <% if review.comment.present? %>
          Comment: <%= review.comment %><br/>
        <% end %>
        <%= review.created_at.to_date %><br />
      </div>
    
    <% end %>
      
    </table>
    
  </div>
  
  
</div>
